/// Instruction builder.
#[derive(Default)]
pub struct {{ instruction.name | pascalCase }}Builder {
{% for account in instruction.accounts %}
  {% if account.isSigner === 'either' %}
    {{ account.name | snakeCase }}: Option<(solana_program::pubkey::Pubkey, bool)>,
  {% else %}
    {{ account.name | snakeCase }}: Option<solana_program::pubkey::Pubkey>,
  {% endif %}
{% endfor %}
{% for arg in instructionArgs %}
  {% if not arg.default %}
    {{ arg.name | snakeCase }}: {{ arg.type if arg.innerOptionType else 'Option<' + arg.type + '>' }},
  {% endif %}
{% endfor %}
}

impl {{ instruction.name | pascalCase }}Builder {
  pub fn new() -> Self {
    Self::default()
  }
  {% for account in instruction.accounts %}
    pub fn {{ account.name | snakeCase }}(&mut self, {{ account.name | snakeCase }}: solana_program::pubkey::Pubkey{{ ', as_signer: bool' if account.isSigner === 'either' }}) -> &mut Self {
      {% if account.isSigner === 'either' %}
        self.{{ account.name | snakeCase }} = Some(({{ account.name | snakeCase }}, as_signer));
      {% else %}
        self.{{ account.name | snakeCase }} = Some({{ account.name | snakeCase }});
      {% endif %}
      self
    }
  {% endfor %}
  {% for arg in instructionArgs %}
    {% if not arg.default %}
      pub fn {{ arg.name | snakeCase }}(&mut self, {{ arg.name | snakeCase }}: {{ arg.innerOptionType or arg.type }}) -> &mut Self {
        self.{{ arg.name | snakeCase }} = Some({{ arg.name | snakeCase }});
        self
      }
    {% endif %}
  {% endfor %}
  pub fn build(&self) -> solana_program::instruction::Instruction {
    let accounts = {{ instruction.name | pascalCase }} {
        {% for account in instruction.accounts %}          
          {{ account.name | snakeCase }}: self.{{ account.name | snakeCase }}{{ '.expect(\"' + account.name | snakeCase + ' is not set\")' if not account.isOptional }},
        {% endfor %}
    };
    {% if hasArgs %}
    let args = {{ instruction.name | pascalCase }}InstructionArgs::new(
      {% for arg in instructionArgs %}
        {% if not arg.default and not arg.optional %}
          self.{{ arg.name | snakeCase }}.clone(){{ '.expect(\"' + arg.name | snakeCase + ' is not set\")' if not arg.innerOptionType }},
        {% endif %}
      {% endfor %}
    );
    {% endif %}
    accounts.instruction({{ 'args' if hasArgs }})
  }
}
